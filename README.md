# Time-varying vector autoregressive model

[![Coverage](https://codecov.io/gh/madskoefoed/TVVAR.jl/branch/master/graph/badge.svg)](https://codecov.io/gh/madskoefoed/TVVAR.jl)
[![Coverage](https://coveralls.io/repos/github/madskoefoed/TVVAR.jl/badge.svg?branch=master)](https://coveralls.io/github/madskoefoed/TVVAR.jl?branch=master)


The package estimates a time-varying vector autoregressive model (TVVAR) by casting it into a state-space model. The volatility is assumed to follow a random walk. The package is based on the paper _Forecasting with time-varying vector autoregressive models, K. Triantafyllopoulus (2008)_.

Assuming that the time series is generated by:

$$\begin{aligned}
y_{t}^{'} = F_{t}^{'} \cdot \Phi_{t} + \epsilon_{t}^{'} \\
\end{aligned}$$

where

$$\begin{aligned}
F_{t} = [1 \quad y_{t-1}^{'} \quad \cdots \quad y_{t-d}^{'}]^{'} \\
\Phi_{t} = [\phi_{0t}^{t} \quad \phi_{1t}^{t} \quad \cdots \quad \phi_{dt}^{t}]^{'} \\
\epsilon_{t} \sim N_{p}(0, \Sigma_{t}) \\
t > d \\
\end{aligned}$$

The $ p \times p $ covariance matrix $ \Sigma_{t} $ is assumed to be symmetric positive-definite and follows:

$$\begin{aligned}
\Sigma_{t}^{-1} = k \Gamma(\Sigma_{t-1}^{-1})' B_{t} \Gamma(\Sigma_{t-1}^{-1}) \\
\end{aligned}$$

where $ \Gamma(\Sigma_{t-1}^{-1}) $ denotes the upper triangular matrix of the Choleski decomposition of $ \Sigma_{t}^{-1} $.

The parameter matrix $ \Phi_{t} $ is assumed to follow a random walk:

$$\begin{aligned}
\Phi_{t} = \Phi_{t-1} + \Omega_{t} \\
\Omega_{t} \sim N_{(dp+1) \times p}(0,W_{t}, \Sigma_{t}) \\
\end{aligned}$$

## Usage
Assume that we have two time series where each has 100 observations ($T=100$) and that we want to estimate a bivariate TVVAR with 3 lags, that is $p = 2$ and $d = 3$. We want to use the first 75 observations to "stabilize" the estimated parameters before updating the model online for the last 25 observations. Before estimating the model we need to set some hyperparameters and priors.

### Simulate data
Before estimating the model we need some datas. We can simulate the two times series using the package's function _simulate_. The true parameters will be chosen as:

$$\begin{equation}
\Phi =
\begin{pmatrix} -1 & 2 \\ -0.5 & 0 \\ 0 & 0 \\ 0 & 0 \\ 0 & 0 \\ 0 & 0 \\ 0.3 & 0.8 \end{pmatrix}
\end{equation}$$

This implies that the intercepts are -1 and 2 for the two time series. The first time series is only (negatively) dependent of its first lag with an effect of -0.5 while the second time series is dependent of the third lag of both series with effects 0.3 and 0.8, respectively.

### Hyperparameters
The hyperparameter $\beta \in [\frac{2}{3};1[$ controls the responsiveness of the covariance matrix while the hyperparameter $\delta \in ]0;1]$ controls the responsiveness of the mean parameters.

(1) Set the hyperparameters:

```julia
# Create the struct Hyperparameters
hyperpar = Hyperparameters(0.9, 0.95)
```

### Prior distributions
At time $t=d$ we assume that we know the quantities $ m_{d} $, $ P_{d} $, and $ S_{d} $, whereby we have the prior distributions $ \Omega_{d} \sim N_{(dp+1) \ times p}N(m_{d}, P_{d}, \Sigma_{d}) $ and $ \Sigma_{t}^{-1} \sim W_{p}(n+2p, S_{d}) $.
In Triantafyllopoulus (2008) a weakly prior specificion is suggested as $ m_{d} = 0_{dp+1 \times p} $, $ P_{d} = 1000I_{dp+1} $, and $ S_{d} = I_{p} $. We can write this in Julia as:

```julia
# Weakly prior specification
m = zeros(2*3+1, 2)
P = PDMat(Diagonal(1000*ones(2*3+1)))
S = PDMat(Diagonal(ones(2)))

# Create the struct Prior
priors = Priors(m, P, S)
```

### Batch estimation
We want to "batch" estimate the first 75 observations to ensure that the data has been allowed to impact the priors. The package offers a function to do this, but first we need to call _TVVAR_ to create a suitable type.

```julia
# Create struct
tvvar = TVVAR(y[1:75, :], priors)

# "Batch" estimate
estimate_batch!(tvvar)
```

We can plot this (assuming we have the package _Plots_ installed) as follows:
```julia
plot(tvvar.Î¼, lw=1, lc=[:black :red], label="")
scatter!(y_example, lw=3, mc=[:black :red], ma=0.5, label=["y1" "y2"])
plot!(legend=:outerbottom, legendcolumn=2)
```

### On-line estimation


```julia
for t in T_example-49:T_example
    predict!(tvvar)
    update!(tvvar, y_example[t, :])
end
```

## Specifications
The package allows the estimation of a variety of models depending on the inputs. The suggested way to use the package is as follows: